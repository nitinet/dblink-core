import INode from './INode.js';
import Join from './types/Join.js';
class Collection extends INode {
  colAlias = null;
  value = null;
  stat = null;
  leftColl = null;
  rightColl = null;
  join = null;
  onExpr = null;
  alias = null;
  resolveJoinType(join) {
    switch (join) {
      case Join.LeftJoin:
        return 'left';
      case Join.RightJoin:
        return 'right';
      case Join.OuterJoin:
        return 'outer';
      default:
        return 'inner';
    }
  }
  eval(handler) {
    let query = '';
    let args = [];
    if (this.value) {
      query = this.colAlias ? `${this.colAlias}.${this.value}` : this.value;
    } else if (this.stat) {
      const { query: stmtQuery, args: stmtArgs } = this.stat.eval(handler);
      query = `(${stmtQuery})`;
      args = stmtArgs;
    } else if (this.leftColl && this.rightColl && this.join && this.onExpr) {
      const { query: leftQuery, args: leftArgs } = this.leftColl.eval(handler);
      const { query: rightQuery, args: rightArgs } = this.rightColl.eval(handler);
      const joinType = this.resolveJoinType(this.join);
      const { query: onExprQuery, args: onExprArgs } = this.onExpr.eval(handler);
      query = `(${leftQuery} ${joinType} join ${rightQuery} on ${onExprQuery})`;
      args.push(...leftArgs, ...rightArgs, ...onExprArgs);
    }
    if (!query) {
      throw new Error('No Collection Found');
    }
    if (this.alias) {
      query = `${query} as ${this.alias}`;
    }
    return { query, args };
  }
}
export default Collection;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29sbGVjdGlvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkNvbGxlY3Rpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxLQUFLLE1BQU0sWUFBWSxDQUFDO0FBRS9CLE9BQU8sSUFBSSxNQUFNLGlCQUFpQixDQUFDO0FBTW5DLE1BQU0sVUFBVyxTQUFRLEtBQUs7SUFNNUIsUUFBUSxHQUFrQixJQUFJLENBQUM7SUFPL0IsS0FBSyxHQUFrQixJQUFJLENBQUM7SUFPNUIsSUFBSSxHQUFxQixJQUFJLENBQUM7SUFPOUIsUUFBUSxHQUFzQixJQUFJLENBQUM7SUFPbkMsU0FBUyxHQUFzQixJQUFJLENBQUM7SUFPcEMsSUFBSSxHQUFnQixJQUFJLENBQUM7SUFPekIsTUFBTSxHQUFzQixJQUFJLENBQUM7SUFPakMsS0FBSyxHQUFrQixJQUFJLENBQUM7SUFRcEIsZUFBZSxDQUFDLElBQVU7UUFDaEMsUUFBUSxJQUFJLEVBQUUsQ0FBQztZQUNiLEtBQUssSUFBSSxDQUFDLFFBQVE7Z0JBQ2hCLE9BQU8sTUFBTSxDQUFDO1lBQ2hCLEtBQUssSUFBSSxDQUFDLFNBQVM7Z0JBQ2pCLE9BQU8sT0FBTyxDQUFDO1lBQ2pCLEtBQUssSUFBSSxDQUFDLFNBQVM7Z0JBQ2pCLE9BQU8sT0FBTyxDQUFDO1lBQ2pCO2dCQUNFLE9BQU8sT0FBTyxDQUFDO1FBQ25CLENBQUM7SUFDSCxDQUFDO0lBUUQsSUFBSSxDQUFDLE9BQWdCO1FBQ25CLElBQUksS0FBSyxHQUFXLEVBQUUsQ0FBQztRQUN2QixJQUFJLElBQUksR0FBYyxFQUFFLENBQUM7UUFHekIsSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDZixLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUN4RSxDQUFDO2FBRUksSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDbkIsTUFBTSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3JFLEtBQUssR0FBRyxJQUFJLFNBQVMsR0FBRyxDQUFDO1lBQ3pCLElBQUksR0FBRyxRQUFRLENBQUM7UUFDbEIsQ0FBQzthQUVJLElBQUksSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ3JFLE1BQU0sRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUN6RSxNQUFNLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDNUUsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDakQsTUFBTSxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRTNFLEtBQUssR0FBRyxJQUFJLFNBQVMsSUFBSSxRQUFRLFNBQVMsVUFBVSxPQUFPLFdBQVcsR0FBRyxDQUFDO1lBQzFFLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxRQUFRLEVBQUUsR0FBRyxTQUFTLEVBQUUsR0FBRyxVQUFVLENBQUMsQ0FBQztRQUN0RCxDQUFDO1FBRUQsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ1gsTUFBTSxJQUFJLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBQ3pDLENBQUM7UUFFRCxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNmLEtBQUssR0FBRyxHQUFHLEtBQUssT0FBTyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDdEMsQ0FBQztRQUVELE9BQU8sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUM7SUFDekIsQ0FBQztDQUNGO0FBRUQsZUFBZSxVQUFVLENBQUMifQ==
